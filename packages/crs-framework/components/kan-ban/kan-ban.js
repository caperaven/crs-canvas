import{addColumnFeatures as l}from"./columns.js";class s extends crsbinding.classes.BindableElement{#a=[];#e=this.refresh.bind(this);get columns(){return this.#a}get html(){return import.meta.url.replace(".js",".html")}async connectedCallback(){await super.connectedCallback(),l(this),await this.#n()}async disconnectedCallback(){for(const a of this.#a)a.container=null;this.#a=null,await super.disconnectedCallback()}async#n(){await this.observe_changes(),await this.refresh()}async#s(){const a=this.container.querySelectorAll("[data-id]");for(let e of a)e.parentElement.removeChild(e)}async#t(a){const e={};for(;a.children.length>0;){const t=a.firstElementChild;t.setAttribute("role","cell");const n=t.dataset.value;e[n]==null&&(e[n]=this.#a.find(i=>i[this.dataset.field]==n).container),t.parentNode.removeChild(t),e[n].appendChild(t)}}async#i(){const a=await crs.call("data_manager","get_all",{manager:this.dataset.manager}),e=crsbinding.inflationManager.get(this.dataset.template,a);await this.#t(e)}async#l(a){this.#a.length!=0&&(await this.#s(),await this.#i())}async#r(a){const e=crsbinding.inflationManager.get(this.dataset.template,a.models);await this.#t(e)}async#c(a){const e=[];for(let t of a.ids){const n=this.container.querySelector(`[data-id="${t}"]`);n!=null&&e.push(n)}for(let t of e)t.parentElement.removeChild(t)}async#d(a){const e=this.container.querySelector(`[data-id="${a.id}"]`),t=await crs.call("data_manager","get",{manager:this.dataset.manager,id:a.id});crsbinding.inflationManager.get(this.dataset.template,[t],[e])}async refresh(a){switch(a?.action||"refresh"){case"refresh":{await this.#l(a);break}case"add":{await this.#r(a);break}case"delete":{await this.#c(a);break}case"update":{await this.#d(a);break}}}async observe_changes(){await crs.call("data_manager","on_change",{manager:this.dataset.manager,callback:this.#e})}async unobserve_changes(){await crs.call("data_manager","remove_change",{manager:this.dataset.manager,callback:this.#e})}}await crs.modules.api("kan_ban",import.meta.url),customElements.define("kan-ban",s);export{s as default};
